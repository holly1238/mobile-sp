


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>iOS &mdash; PyTorch Mobile .0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <!-- Google Analytics -->
  
  <!-- End Google Analytics -->
  

  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">PyTorch Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploymentWorkflow.html">Deployment Workflow</a></li>
</ul>
<p class="caption"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstarts/androidquickstart.html">Android Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstarts/iosquickstart.html">iOS Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Build From Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="androidsourcebuild.html">Building PyTorch Android from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="iossourcebuild.html">Building PyTorch iOS from Source</a></li>
</ul>
<p class="caption"><span class="caption-text">Binary Size Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="selectivebuild/andriodSelectiveBuild.html">Andriod Selective Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="selectivebuild/iosSelectiveBuild.html">iOS Selective Build</a></li>
</ul>
<p class="caption"><span class="caption-text">Using PyTorch Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usinglibraries/usingAndroidLibraries.html">Using the PyTorch Android Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="usinglibraries/usingiosLibraries.html">Using the PyTorch iOS Libraries</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modelprep/quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelprep/scriptOptimizeMobile.html">Script and Optimize for Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelprep/liteJitInterpreters.html">Lite and Full Jit Interpreters</a></li>
</ul>
<p class="caption"><span class="caption-text">Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="performance/bestPractices.html">Pytorch Mobile Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance/fuseModules.html">Fuse Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance/andriodBenchmark.html">Andriod Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance/iosBenchmark.html">iOS Benchmarking</a></li>
</ul>
<p class="caption"><span class="caption-text">Backends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="backends/GPUandroid.html">Using GPU on Andriod (Vulkan Backend)</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends/GPUiOS.html">Using GPU on iOS (Metal Backend)</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends/NNAPIandroid.html">Convert MobileNetV2 to NNAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends/coreMLios.html">Core ML on iOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Custom Operators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="customOperators.html">Andriod Native Application with Custom Operators</a></li>
</ul>
<p class="caption"><span class="caption-text">Run Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="runInference.html">Operator Compatibility</a></li>
</ul>
<p class="caption"><span class="caption-text">Video Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="videos/runtimeAndroid.html">PyTorch Mobile Runtime for Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="videos/runtimeiOS.html">PyTorch Mobile Runtime for iOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Android Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidD2Go.html">Android D2Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidImageSegmentation.html">Image Segmentation DeepLabV3 on Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidObjectDetection.html">Android Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidNeuralMachineTranslation.html">Android Neural Machine Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidQuestionAnswering.html">Android Question Answering</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidVisionTransformer.html">Android Vision Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidSpeechRecognition.html">Android Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="androidTutorials/androidVideoClassification.html">Android Video Classification</a></li>
</ul>
<p class="caption"><span class="caption-text">iOS Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosD2Go.html">iOS D2Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosImageSegmentation.html">Image Segmentation DeepLabV3 on iOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosObjectDetection.html">iOS Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosNeuralMachineTranslation.html">iOS Neural Machine Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosQuestionAnswering.html">iOS Question Answering</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosVisionTransformer.html">iOS Vision Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosSpeechRecognition.html">iOS Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosTutorials/iosVideoClassification.html">iOS Video Classification</a></li>
</ul>
<p class="caption"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Mobile API Docs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="contents.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>iOS</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/ios.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="ios">
<h1>iOS<a class="headerlink" href="#ios" title="Permalink to this headline">¶</a></h1>
<p>To get started with PyTorch on iOS, we recommend exploring the following
<a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/HelloWorld">HelloWorld</a>.</p>
<div class="section" id="quickstart-with-a-hello-world-example">
<h2>Quickstart with a Hello World Example<a class="headerlink" href="#quickstart-with-a-hello-world-example" title="Permalink to this headline">¶</a></h2>
<p>HelloWorld is a simple image classification application that
demonstrates how to use PyTorch C++ libraries on iOS. The code is
written in Swift and uses Objective-C as a bridge.</p>
<div class="section" id="model-preparation">
<h3>Model Preparation<a class="headerlink" href="#model-preparation" title="Permalink to this headline">¶</a></h3>
<p>Let’s start with model preparation. If you are familiar with PyTorch,
you probably should already know how to train and save your model. In
case you don’t, we are going to use a pre-trained image classification
model - <a class="reference external" href="https://pytorch.org/hub/pytorch_vision_mobilenet_v2/">MobileNet
v2</a>, which is
already packaged in
<a class="reference external" href="https://pytorch.org/docs/stable/torchvision/index.html">TorchVision</a>.
To install it, run the command below.</p>
<blockquote>
<div>We highly recommend following the <a class="reference external" href="https://github.com/pytorch/pytorch">Pytorch Github
page</a> to set up the Python
development environment on your local machine.</div></blockquote>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">torchvision</span>
</pre></div>
</div>
<p>Once we have TorchVision installed successfully, let’s navigate to the
HelloWorld folder and run <code class="docutils literal notranslate"><span class="pre">trace_model.py</span></code>. The script contains the
code of tracing and saving a <a class="reference external" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">torchscript
model</a>
that can be run on mobile devices.</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">trace_model</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If everything works well, we should have our model - <code class="docutils literal notranslate"><span class="pre">model.pt</span></code>
generated in the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> folder. Now copy the model file to our
application folder <code class="docutils literal notranslate"><span class="pre">HelloWorld/model</span></code>.</p>
<blockquote>
<div>To find out more details about TorchScript, please visit <a class="reference external" href="https://pytorch.org/tutorials/advanced/cpp_export.html">tutorials
on
pytorch.org</a></div></blockquote>
</div>
<div class="section" id="install-libtorch-via-cocoapods">
<h3>Install LibTorch via Cocoapods<a class="headerlink" href="#install-libtorch-via-cocoapods" title="Permalink to this headline">¶</a></h3>
<p>The PyTorch C++ library is available in
<a class="reference external" href="https://cocoapods.org/">Cocoapods</a>, to integrate it to our project,
simply run</p>
<div class="code ruby highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pod</span> <span class="n">install</span>
</pre></div>
</div>
<p>Now it’s time to open the <code class="docutils literal notranslate"><span class="pre">HelloWorld.xcworkspace</span></code> in XCode, select an
iOS simulator and launch it (cmd + R). If everything works well, we
should see a wolf picture on the simulator screen along with the
prediction result.</p>
</div>
<div class="section" id="code-walkthrough">
<h3>Code Walkthrough<a class="headerlink" href="#code-walkthrough" title="Permalink to this headline">¶</a></h3>
<p>In this part, we are going to walk through the code step by step.</p>
<div class="section" id="image-loading">
<h4>Image Loading<a class="headerlink" href="#image-loading" title="Permalink to this headline">¶</a></h4>
<p>Let’s begin with image loading.</p>
<div class="code swift highlight-default notranslate"><div class="highlight"><pre><span></span>let image = UIImage(named: &quot;image.jpg&quot;)!
imageView.image = image
let resizedImage = image.resized(to: CGSize(width: 224, height: 224))
guard var pixelBuffer = resizedImage.normalized() else {
    return
}
</pre></div>
</div>
<p>We first load the image from our bundle and resize it to 224x224. Then
we call this <code class="docutils literal notranslate"><span class="pre">normalized()</span></code> category method to normalized the pixel
buffer. Let’s take a closer look at the code below.</p>
<div class="code swift highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">normalizedBuffer</span><span class="p">:</span> <span class="p">[</span><span class="n">Float32</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Float32</span><span class="p">](</span><span class="n">repeating</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">//</span> <span class="n">normalize</span> <span class="n">the</span> <span class="n">pixel</span> <span class="n">buffer</span>
<span class="o">//</span> <span class="n">see</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pytorch</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">hub</span><span class="o">/</span><span class="n">pytorch_vision_resnet</span><span class="o">/</span> <span class="k">for</span> <span class="n">more</span> <span class="n">detail</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="p">{</span>
    <span class="n">normalizedBuffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>             <span class="o">=</span> <span class="p">(</span><span class="n">Float32</span><span class="p">(</span><span class="n">rawBytes</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">255.0</span> <span class="o">-</span> <span class="mf">0.485</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.229</span> <span class="o">//</span> <span class="n">R</span>
    <span class="n">normalizedBuffer</span><span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>     <span class="o">=</span> <span class="p">(</span><span class="n">Float32</span><span class="p">(</span><span class="n">rawBytes</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">255.0</span> <span class="o">-</span> <span class="mf">0.456</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.224</span> <span class="o">//</span> <span class="n">G</span>
    <span class="n">normalizedBuffer</span><span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Float32</span><span class="p">(</span><span class="n">rawBytes</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">255.0</span> <span class="o">-</span> <span class="mf">0.406</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.225</span> <span class="o">//</span> <span class="n">B</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The code might look weird at first glance, but it’ll make sense once we
understand our model. The input data is a 3-channel RGB image of shape
(3 x H x W), where H and W are expected to be at least 224. The image
has to be loaded in to a range of <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code> and then normalized using
<code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">=</span> <span class="pre">[0.485,</span> <span class="pre">0.456,</span> <span class="pre">0.406]</span></code> and <code class="docutils literal notranslate"><span class="pre">std</span> <span class="pre">=</span> <span class="pre">[0.229,</span> <span class="pre">0.224,</span> <span class="pre">0.225]</span></code>.</p>
</div>
<div class="section" id="torchscript-module">
<h4>TorchScript Module<a class="headerlink" href="#torchscript-module" title="Permalink to this headline">¶</a></h4>
<p>Now that we have preprocessed our input data and we have a pre-trained
TorchScript model, the next step is to use them to run predication. To
do that, we’ll first load our model into the application.</p>
<div class="code swift highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">lazy</span> <span class="n">var</span> <span class="n">module</span><span class="p">:</span> <span class="n">TorchModule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">let</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">ofType</span><span class="p">:</span> <span class="s2">&quot;pt&quot;</span><span class="p">),</span>
        <span class="n">let</span> <span class="n">module</span> <span class="o">=</span> <span class="n">TorchModule</span><span class="p">(</span><span class="n">fileAtPath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">module</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">fatalError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find the model file!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}()</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">TorchModule</span></code> Class is an Objective-C wrapper of
<code class="docutils literal notranslate"><span class="pre">torch::jit::mobile::Module</span></code>.</p>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="p">::</span><span class="n">jit</span><span class="p">::</span><span class="n">mobile</span><span class="p">::</span><span class="n">Module</span> <span class="n">module</span> <span class="o">=</span> <span class="n">torch</span><span class="p">::</span><span class="n">jit</span><span class="p">::</span><span class="n">_load_for_mobile</span><span class="p">(</span><span class="n">filePath</span><span class="o">.</span><span class="n">UTF8String</span><span class="p">);</span>
</pre></div>
</div>
<p>Since Swift can not talk to C++ directly, we have to either use an
Objective-C class as a bridge, or create a C wrapper for the C++
library. For demo purpose, we’re going to wrap everything in this
Objective-C class.</p>
</div>
<div class="section" id="run-inference">
<h4>Run Inference<a class="headerlink" href="#run-inference" title="Permalink to this headline">¶</a></h4>
<p>Now it’s time to run inference and get the results.</p>
<div class="code swift highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guard</span> <span class="n">let</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">UnsafeMutableRawPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pixelBuffer</span><span class="p">))</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Again, the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method is just an Objective-C wrapper. Under the
hood, it calls the C++ <code class="docutils literal notranslate"><span class="pre">forward</span></code> function. Let’s take a look at how
it’s implemented.</p>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">at</span><span class="p">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">::</span><span class="n">from_blob</span><span class="p">(</span><span class="n">imageBuffer</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">},</span> <span class="n">at</span><span class="p">::</span><span class="n">kFloat</span><span class="p">);</span>
<span class="n">torch</span><span class="p">::</span><span class="n">autograd</span><span class="p">::</span><span class="n">AutoGradMode</span> <span class="n">guard</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="n">auto</span> <span class="n">outputTensor</span> <span class="o">=</span> <span class="n">_impl</span><span class="o">.</span><span class="n">forward</span><span class="p">({</span><span class="n">tensor</span><span class="p">})</span><span class="o">.</span><span class="n">toTensor</span><span class="p">();</span>
<span class="nb">float</span><span class="o">*</span> <span class="n">floatBuffer</span> <span class="o">=</span> <span class="n">outputTensor</span><span class="o">.</span><span class="n">data_ptr</span><span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>The C++ function <code class="docutils literal notranslate"><span class="pre">torch::from_blob</span></code> will create an input tensor from
the pixel buffer. Note that the shape of the tensor is <code class="docutils literal notranslate"><span class="pre">{1,3,224,224}</span></code>
which represents <code class="docutils literal notranslate"><span class="pre">NxCxWxH</span></code> as we discussed in the above section.</p>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="p">::</span><span class="n">autograd</span><span class="p">::</span><span class="n">AutoGradMode</span> <span class="n">guard</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="n">at</span><span class="p">::</span><span class="n">AutoNonVariableTypeMode</span> <span class="n">non_var_type_mode</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The above two lines tells the PyTorch engine to do inference only. This
is because by default, PyTorch has built-in support for doing
auto-differentiation, which is also known as
<a class="reference external" href="https://pytorch.org/docs/stable/notes/autograd.html">autograd</a>.
Since we don’t do training on mobile, we can just disable the autograd
mode.</p>
<p>Finally, we can call this <code class="docutils literal notranslate"><span class="pre">forward</span></code> function to get the output tensor
and convert it to a <code class="docutils literal notranslate"><span class="pre">float</span></code> buffer.</p>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">outputTensor</span> <span class="o">=</span> <span class="n">_impl</span><span class="o">.</span><span class="n">forward</span><span class="p">({</span><span class="n">tensor</span><span class="p">})</span><span class="o">.</span><span class="n">toTensor</span><span class="p">();</span>
<span class="nb">float</span><span class="o">*</span> <span class="n">floatBuffer</span> <span class="o">=</span> <span class="n">outputTensor</span><span class="o">.</span><span class="n">data_ptr</span><span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="collect-results">
<h3>Collect Results<a class="headerlink" href="#collect-results" title="Permalink to this headline">¶</a></h3>
<p>The output tensor is a one-dimensional float array of shape 1x1000,
where each value represents the confidence that a label is predicted
from the image. The code below sorts the array and retrieves the top
three results.</p>
<div class="code swift highlight-default notranslate"><div class="highlight"><pre><span></span>let zippedResults = zip(labels.indices, outputs)
let sortedResults = zippedResults.sorted { $0.1.floatValue &gt; $1.1.floatValue }.prefix(3)
</pre></div>
</div>
</div>
</div>
<div class="section" id="pytorch-demo-app">
<h2>PyTorch Demo App<a class="headerlink" href="#pytorch-demo-app" title="Permalink to this headline">¶</a></h2>
<p>For more complex use cases, we recommend to check out the <a class="reference external" href="https://github.com/pytorch/ios-demo-app">PyTorch demo
application</a>. The demo app
contains two showcases. A camera app that runs a quantized model to
predict the images coming from device’s rear-facing camera in real time.
And a text-based app that uses a text classification model to predict
the topic from the input string.</p>
</div>
<div class="section" id="more-pytorch-ios-demo-apps">
<h2>More PyTorch iOS Demo Apps<a class="headerlink" href="#more-pytorch-ios-demo-apps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="image-segmentation">
<h3>Image Segmentation<a class="headerlink" href="#image-segmentation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/ImageSegmentation">Image
Segmentation</a>
demonstrates a Python script that converts the PyTorch
<a class="reference external" href="https://pytorch.org/hub/pytorch_vision_deeplabv3_resnet101/">DeepLabV3</a>
model for mobile apps to use and an iOS app that uses the model to
segment images.</p>
</div>
<div class="section" id="object-detection">
<h3>Object Detection<a class="headerlink" href="#object-detection" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/ObjectDetection">Object
Detection</a>
demonstrates how to convert the popular
<a class="reference external" href="https://pytorch.org/hub/ultralytics_yolov5/">YOLOv5</a> model and use
it on an iOS app that detects objects from pictures in your photos,
taken with camera, or with live camera.</p>
</div>
<div class="section" id="neural-machine-translation">
<h3>Neural Machine Translation<a class="headerlink" href="#neural-machine-translation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/Seq2SeqNMT">Neural Machine
Translation</a>
demonstrates how to convert a sequence-to-sequence neural machine
translation model trained with the code in the <a class="reference external" href="https://pytorch.org/tutorials/intermediate/seq2seq_translation_tutorial.html">PyTorch NMT
tutorial</a>
and use the model in an iOS app to do French-English translation.</p>
</div>
<div class="section" id="question-answering">
<h3>Question Answering<a class="headerlink" href="#question-answering" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/QuestionAnswering">Question
Answering</a>
demonstrates how to convert a powerful transformer QA model and use the
model in an iOS app to answer questions about PyTorch Mobile and more.</p>
</div>
<div class="section" id="vision-transformer">
<h3>Vision Transformer<a class="headerlink" href="#vision-transformer" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/ViT4MNIST">Vision
Transformer</a>
demonstrates how to use Facebook’s latest Vision Transformer
<a class="reference external" href="https://github.com/facebookresearch/deit">DeiT</a> model to do image
classification, and how convert another Vision Transformer model and use
it in an iOS app to perform handwritten digit recognition.</p>
</div>
<div class="section" id="speech-recognition">
<h3>Speech recognition<a class="headerlink" href="#speech-recognition" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/SpeechRecognition">Speech
Recognition</a>
demonstrates how to convert Facebook AI’s wav2vec 2.0, one of the
leading models in speech recognition, to TorchScript and how to use the
scripted model in an iOS app to perform speech recognition.</p>
</div>
<div class="section" id="video-classification">
<h3>Video Classification<a class="headerlink" href="#video-classification" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/TorchVideo">TorchVideo</a>
demonstrates how to use a pre-trained video classification model,
available at the newly released
<a class="reference external" href="https://github.com/facebookresearch/pytorchvideo">PyTorchVideo</a>, on
iOS to see video classification results, updated per second while the
video plays, on tested videos, videos from the Photos library, or even
real-time videos.</p>
</div>
</div>
<div class="section" id="pytorch-ios-tutorial-and-recipes">
<h2>PyTorch iOS Tutorial and Recipes<a class="headerlink" href="#pytorch-ios-tutorial-and-recipes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="image-segmentation-deeplabv3-on-ios">
<h3><a class="reference external" href="https://pytorch.org/tutorials/beginner/deeplabv3_on_ios.html">Image Segmentation DeepLabV3 on iOS</a><a class="headerlink" href="#image-segmentation-deeplabv3-on-ios" title="Permalink to this headline">¶</a></h3>
<p>A comprehensive step-by-step tutorial on how to prepare and run the
PyTorch DeepLabV3 image segmentation model on iOS.</p>
</div>
<div class="section" id="pytorch-mobile-performance-recipes">
<h3><a class="reference external" href="https://pytorch.org/tutorials/recipes/mobile_perf.html">PyTorch Mobile Performance Recipes</a><a class="headerlink" href="#pytorch-mobile-performance-recipes" title="Permalink to this headline">¶</a></h3>
<p>List of recipes for performance optimizations for using PyTorch on
Mobile.</p>
</div>
<div class="section" id="fuse-modules-recipe">
<h3><a class="reference external" href="https://pytorch.org/tutorials/recipes/fuse.html">Fuse Modules recipe</a><a class="headerlink" href="#fuse-modules-recipe" title="Permalink to this headline">¶</a></h3>
<p>Learn how to fuse a list of PyTorch modules into a single module to
reduce the model size before quantization.</p>
</div>
<div class="section" id="quantization-for-mobile-recipe">
<h3><a class="reference external" href="https://pytorch.org/tutorials/recipes/quantization.html">Quantization for Mobile Recipe</a><a class="headerlink" href="#quantization-for-mobile-recipe" title="Permalink to this headline">¶</a></h3>
<p>Learn how to reduce the model size and make it run faster without losing
much on accuracy.</p>
</div>
<div class="section" id="script-and-optimize-for-mobile">
<h3><a class="reference external" href="https://pytorch.org/tutorials/recipes/script_optimized.html">Script and Optimize for Mobile</a><a class="headerlink" href="#script-and-optimize-for-mobile" title="Permalink to this headline">¶</a></h3>
<p>Learn how to convert the model to TorchScipt and (optional) optimize it
for mobile apps.</p>
</div>
<div class="section" id="model-preparation-for-ios-recipe">
<h3><a class="reference external" href="https://pytorch.org/tutorials/recipes/model_preparation_ios.html">Model Preparation for iOS Recipe</a><a class="headerlink" href="#model-preparation-for-ios-recipe" title="Permalink to this headline">¶</a></h3>
<p>Learn how to add the model in an iOS project and use PyTorch pod for
iOS.</p>
</div>
</div>
<div class="section" id="build-pytorch-ios-libraries-from-source">
<h2>Build PyTorch iOS Libraries from Source<a class="headerlink" href="#build-pytorch-ios-libraries-from-source" title="Permalink to this headline">¶</a></h2>
<p>To track the latest updates for iOS, you can build the PyTorch iOS
libraries from the source code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">pytorch</span><span class="o">/</span><span class="n">pytorch</span>
<span class="n">cd</span> <span class="n">pytorch</span>
<span class="c1"># if you are updating an existing checkout</span>
<span class="n">git</span> <span class="n">submodule</span> <span class="n">sync</span>
<span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span> <span class="o">--</span><span class="n">init</span> <span class="o">--</span><span class="n">recursive</span>
</pre></div>
</div>
<blockquote>
<div>Make sure you have <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and Python installed correctly on your
local machine. We recommend following the <a class="reference external" href="https://github.com/pytorch/pytorch">Pytorch Github
page</a> to set up the Python
development environment</div></blockquote>
<div class="section" id="build-libtorch-for-ios-simulators">
<h3>Build LibTorch for iOS Simulators<a class="headerlink" href="#build-libtorch-for-ios-simulators" title="Permalink to this headline">¶</a></h3>
<p>Open terminal and navigate to the PyTorch root directory. Run the
following command (if you already build LibTorch for iOS devices (see
below), run <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">build_ios</span></code> first):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BUILD_PYTORCH_MOBILE</span><span class="o">=</span><span class="mi">1</span> <span class="n">IOS_PLATFORM</span><span class="o">=</span><span class="n">SIMULATOR</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">build_ios</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>After the build succeeds, all static libraries and header files will be
generated under <code class="docutils literal notranslate"><span class="pre">build_ios/install</span></code></p>
</div>
<div class="section" id="build-libtorch-for-arm64-devices">
<h3>Build LibTorch for arm64 Devices<a class="headerlink" href="#build-libtorch-for-arm64-devices" title="Permalink to this headline">¶</a></h3>
<p>Open terminal and navigate to the PyTorch root directory. Run the
following command (if you already build LibTorch for iOS simulators, run
<code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">build_ios</span></code> first):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BUILD_PYTORCH_MOBILE</span><span class="o">=</span><span class="mi">1</span> <span class="n">IOS_ARCH</span><span class="o">=</span><span class="n">arm64</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">build_ios</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>After the build succeeds, all static libraries and header files will be
generated under <code class="docutils literal notranslate"><span class="pre">build_ios/install</span></code></p>
</div>
<div class="section" id="xcode-setup">
<h3>XCode Setup<a class="headerlink" href="#xcode-setup" title="Permalink to this headline">¶</a></h3>
<p>Open your project in XCode, go to your project Target’s <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Phases</span></code>
- <code class="docutils literal notranslate"><span class="pre">Link</span> <span class="pre">Binaries</span> <span class="pre">With</span> <span class="pre">Libraries</span></code>, click the + sign and add all the
library files located in <code class="docutils literal notranslate"><span class="pre">build_ios/install/lib</span></code>. Navigate to the
project <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Settings</span></code>, set the value <strong>Header Search Paths</strong> to
<code class="docutils literal notranslate"><span class="pre">build_ios/install/include</span></code> and <strong>Library Search Paths</strong> to
<code class="docutils literal notranslate"><span class="pre">build_ios/install/lib</span></code>.</p>
<p>In the build settings, search for <strong>other linker flags</strong>. Add a custom
linker flag below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">all_load</span>
</pre></div>
</div>
<p>To use the custom built libraries the project, replace
<code class="docutils literal notranslate"><span class="pre">#import</span> <span class="pre">&lt;LibTorch/LibTorch.h&gt;</span></code> (in <code class="docutils literal notranslate"><span class="pre">TorchModule.mm</span></code>) which is
needed when using LibTorch via Cocoapods with the code below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;ATen/ATen.h&quot;</span>
<span class="c1">#include &quot;caffe2/core/timer.h&quot;</span>
<span class="c1">#include &quot;caffe2/utils/string_utils.h&quot;</span>
<span class="c1">#include &quot;torch/csrc/autograd/grad_mode.h&quot;</span>
<span class="c1">#include &quot;torch/csrc/jit/mobile/import.h&quot;</span>
<span class="c1">#include &quot;torch/csrc/jit/mobile/module.h&quot;</span>
<span class="c1">#include &quot;torch/script.h&quot;</span>
</pre></div>
</div>
<p>Finally, disable bitcode for your target by selecting the Build
Settings, searching for <strong>Enable Bitcode</strong>, and set the value to <strong>No</strong>.</p>
</div>
</div>
<div class="section" id="custom-build">
<h2>Custom Build<a class="headerlink" href="#custom-build" title="Permalink to this headline">¶</a></h2>
<p>Starting from 1.4.0, PyTorch supports custom build. You can now build
the PyTorch library that only contains the operators needed by your
model. To do that, follow the steps below</p>
<p>1. Verify your PyTorch version is 1.4.0 or above. You can do that by
checking the value of <code class="docutils literal notranslate"><span class="pre">torch.__version__</span></code>.</p>
<p>2. To dump the operators in your model, say <code class="docutils literal notranslate"><span class="pre">MobileNetV2</span></code>, run the
following lines of Python code:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">yaml</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;MobileNetV2.pt&#39;</span><span class="p">)</span>
<span class="n">ops</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export_opnames</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;MobileNetV2.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ops</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>In the snippet above, you first need to load the ScriptModule. Then, use
<code class="docutils literal notranslate"><span class="pre">export_opnames</span></code> to return a list of operator names of the
ScriptModule and its submodules. Lastly, save the result in a yaml file.</p>
<p>3. To run the iOS build script locally with the prepared yaml list of
operators, pass in the yaml file generate from the last step into the
environment variable <code class="docutils literal notranslate"><span class="pre">SELECTED_OP_LIST</span></code>. Also in the arguments,
specify <code class="docutils literal notranslate"><span class="pre">BUILD_PYTORCH_MOBILE=1</span></code> as well as the platform/architechture
type. Take the arm64 build for example, the command should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECTED_OP_LIST</span><span class="o">=</span><span class="n">MobileNetV2</span><span class="o">.</span><span class="n">yaml</span> <span class="n">BUILD_PYTORCH_MOBILE</span><span class="o">=</span><span class="mi">1</span> <span class="n">IOS_ARCH</span><span class="o">=</span><span class="n">arm64</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">build_ios</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>4. After the build succeeds, you can integrate the result libraries to
your project by following the <a class="reference external" href="#xcode-setup">XCode Setup</a> section
above.</p>
<p>5. The last step is to add a single line of C++ code before running
<code class="docutils literal notranslate"><span class="pre">forward</span></code>. This is because by default JIT will do some optimizations
on operators (fusion for example), which might break the consistency
with the ops we dumped from the model.</p>
<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="p">::</span><span class="n">jit</span><span class="p">::</span><span class="n">GraphOptimizerEnabledGuard</span> <span class="n">guard</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="use-pytorch-jit-interpreter">
<h2>Use PyTorch JIT interpreter<a class="headerlink" href="#use-pytorch-jit-interpreter" title="Permalink to this headline">¶</a></h2>
<p>PyTorch JIT interpreter is the default interpreter before 1.9 (a version
of our PyTorch interpreter that is not as size-efficient). It will still
be supported in 1.9, and can be used in CocoaPods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pod</span> <span class="s1">&#39;LibTorch&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt;1.9.0&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="ios-tutorials">
<h2>iOS Tutorials<a class="headerlink" href="#ios-tutorials" title="Permalink to this headline">¶</a></h2>
<p>Watch the following <a class="reference external" href="https://youtu.be/amTepUIR93k">video</a> as PyTorch
Partner Engineer Brad Heintz walks through steps for setting up the
PyTorch Runtime for iOS projects:</p>
<p><a class="reference external" href="https://youtu.be/amTepUIR93k%22%20PyTorch%20Mobile%20Runtime%20for%20iOS%22">|PyTorch Mobile Runtime for iOS|{:height=“75%”
width=“75%”}</a></p>
<p>The corresponding code can be found
<a class="reference external" href="https://github.com/pytorch/workshops/tree/master/PTMobileWalkthruIOS">here</a>.</p>
<p>Additionally, checkout our <a class="reference external" href="https://pytorch.org/tutorials/recipes/mobile_perf.html">Mobile Performance
Recipes</a>
which cover how to optimize your model and check if optimizations helped
via benchmarking.</p>
</div>
<div class="section" id="api-docs">
<h2>API Docs<a class="headerlink" href="#api-docs" title="Permalink to this headline">¶</a></h2>
<p>Currently, the iOS framework uses the Pytorch C++ front-end APIs
directly. The C++ document can be found
<a class="reference external" href="https://pytorch.org/cppdocs/">here</a>. To learn more about it, we
recommend exploring the <a class="reference external" href="https://pytorch.org/tutorials/advanced/cpp_frontend.html">C++ front-end
tutorials</a>
on PyTorch webpage.</p>
</div>
<div class="section" id="issues-and-contribution">
<h2>Issues and Contribution<a class="headerlink" href="#issues-and-contribution" title="Permalink to this headline">¶</a></h2>
<p>If you have any questions or want to contribute to PyTorch, please feel
free to drop issues or open a pull request to get in touch.</p>
<!-- Do not remove the below script --><script page-id="ios" src="{{ site.baseurl }}/assets/menu-tab-selection.js"></script></div>
</div>


             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Facebook.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">iOS</a><ul>
<li><a class="reference internal" href="#quickstart-with-a-hello-world-example">Quickstart with a Hello World Example</a><ul>
<li><a class="reference internal" href="#model-preparation">Model Preparation</a></li>
<li><a class="reference internal" href="#install-libtorch-via-cocoapods">Install LibTorch via Cocoapods</a></li>
<li><a class="reference internal" href="#code-walkthrough">Code Walkthrough</a><ul>
<li><a class="reference internal" href="#image-loading">Image Loading</a></li>
<li><a class="reference internal" href="#torchscript-module">TorchScript Module</a></li>
<li><a class="reference internal" href="#run-inference">Run Inference</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collect-results">Collect Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pytorch-demo-app">PyTorch Demo App</a></li>
<li><a class="reference internal" href="#more-pytorch-ios-demo-apps">More PyTorch iOS Demo Apps</a><ul>
<li><a class="reference internal" href="#image-segmentation">Image Segmentation</a></li>
<li><a class="reference internal" href="#object-detection">Object Detection</a></li>
<li><a class="reference internal" href="#neural-machine-translation">Neural Machine Translation</a></li>
<li><a class="reference internal" href="#question-answering">Question Answering</a></li>
<li><a class="reference internal" href="#vision-transformer">Vision Transformer</a></li>
<li><a class="reference internal" href="#speech-recognition">Speech recognition</a></li>
<li><a class="reference internal" href="#video-classification">Video Classification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pytorch-ios-tutorial-and-recipes">PyTorch iOS Tutorial and Recipes</a><ul>
<li><a class="reference internal" href="#image-segmentation-deeplabv3-on-ios">Image Segmentation DeepLabV3 on iOS</a></li>
<li><a class="reference internal" href="#pytorch-mobile-performance-recipes">PyTorch Mobile Performance Recipes</a></li>
<li><a class="reference internal" href="#fuse-modules-recipe">Fuse Modules recipe</a></li>
<li><a class="reference internal" href="#quantization-for-mobile-recipe">Quantization for Mobile Recipe</a></li>
<li><a class="reference internal" href="#script-and-optimize-for-mobile">Script and Optimize for Mobile</a></li>
<li><a class="reference internal" href="#model-preparation-for-ios-recipe">Model Preparation for iOS Recipe</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-pytorch-ios-libraries-from-source">Build PyTorch iOS Libraries from Source</a><ul>
<li><a class="reference internal" href="#build-libtorch-for-ios-simulators">Build LibTorch for iOS Simulators</a></li>
<li><a class="reference internal" href="#build-libtorch-for-arm64-devices">Build LibTorch for arm64 Devices</a></li>
<li><a class="reference internal" href="#xcode-setup">XCode Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-build">Custom Build</a></li>
<li><a class="reference internal" href="#use-pytorch-jit-interpreter">Use PyTorch JIT interpreter</a></li>
<li><a class="reference internal" href="#ios-tutorials">iOS Tutorials</a></li>
<li><a class="reference internal" href="#api-docs">API Docs</a></li>
<li><a class="reference internal" href="#issues-and-contribution">Issues and Contribution</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script type="text/javascript" src="_static/jquery.js"></script>
         <script type="text/javascript" src="_static/underscore.js"></script>
         <script type="text/javascript" src="_static/doctools.js"></script>
         <script type="text/javascript" src="_static/language_data.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #00ff00;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #E73422;
    }
  </style>

<script script type="text/javascript">
  var collapsedSections = ['Quickstart', 'Build From Source', 'Binary Size Optimization', 'Using PyTorch Libraries', 'Model Preparation', 'Performance', 'Backends', 'Custom Operators', 'Run Inference', 'Video Tutorials', 'Android Tutorials', 'iOS Tutorials', 'API Docs'];
</script>
  


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>