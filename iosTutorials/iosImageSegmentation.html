


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Image Segmentation DeepLabV3 on iOS &mdash; PyTorch Mobile .0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="iOS Object Detection" href="iosObjectDetection.html" />
    <link rel="prev" title="iOS D2Go" href="iosD2Go.html" />
  <!-- Google Analytics -->
  
  <!-- End Google Analytics -->
  

  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">PyTorch Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploymentWorkflow.html">Deployment workflow</a></li>
</ul>
<p class="caption"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/androidquickstart.html">Android Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstarts/iosquickstart.html">iOS Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Build From Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../androidsourcebuild.html">Building PyTorch Android from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iossourcebuild.html">Building PyTorch iOS from Source</a></li>
</ul>
<p class="caption"><span class="caption-text">Binary Size Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../selectivebuild/andriodSelectiveBuild.html">Andriod Selective Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../selectivebuild/iosSelectiveBuild.html">iOS Selective Build</a></li>
</ul>
<p class="caption"><span class="caption-text">Using PyTorch Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usinglibraries/usingAndroidLibraries.html">Using the PyTorch Android Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usinglibraries/usingiosLibraries.html">Using the PyTorch iOS Libraries</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modelprep/quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelprep/scriptOptimizeMobile.html">Script and Optimize for Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelprep/liteJitInterpreters.html">Lite and Full Jit Interpreters</a></li>
</ul>
<p class="caption"><span class="caption-text">Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../performance/bestPractices.html">Pytorch Mobile Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/fuseModules.html">Fuse Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/andriodBenchmark.html">Andriod Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/iosBenchmark.html">iOS Benchmarking</a></li>
</ul>
<p class="caption"><span class="caption-text">Backends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../backends/GPUandroid.html">Using GPU on Andriod (Vulkan Backend)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/GPUiOS.html">Using GPU on iOS (Metal Backend)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/NNAPIandroid.html">Convert MobileNetV2 to NNAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends/coreMLios.html">Core ML on iOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Custom Operators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../customOperators.html">Andriod Native Application with Custom Operators</a></li>
</ul>
<p class="caption"><span class="caption-text">Run Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../runInference.html">Operator Compatibility</a></li>
</ul>
<p class="caption"><span class="caption-text">Video Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../videos/runtimeAndroid.html">PyTorch Mobile Runtime for Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/runtimeiOS.html">PyTorch Mobile Runtime for iOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Android Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidD2Go.html">Android D2Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidImageSegmentation.html">Image Segmentation DeepLabV3 on Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidObjectDetection.html">Android Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidNeuralMachineTranslation.html">Android Neural Machine Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidQuestionAnswering.html">Android Question Answering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidVisionTransformer.html">Android Vision Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidSpeechRecognition.html">Android Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../androidTutorials/androidVideoClassification.html">Android Video Classification</a></li>
</ul>
<p class="caption"><span class="caption-text">iOS Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="iosD2Go.html">iOS D2Go</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image Segmentation DeepLabV3 on iOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosObjectDetection.html">iOS Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosNeuralMachineTranslation.html">iOS Neural Machine Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosQuestionAnswering.html">iOS Question Answering</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosVisionTransformer.html">iOS Vision Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosSpeechRecognition.html">iOS Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="iosVideoClassification.html">iOS Video Classification</a></li>
</ul>
<p class="caption"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Mobile API Docs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../contents.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Image Segmentation DeepLabV3 on iOS</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/iosTutorials/iosImageSegmentation.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="image-segmentation-deeplabv3-on-ios">
<h1>Image Segmentation DeepLabV3 on iOS<a class="headerlink" href="#image-segmentation-deeplabv3-on-ios" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Author</strong>: <a class="reference external" href="https://github.com/jeffxtang">Jeff Tang</a></p>
<p><strong>Reviewed by</strong>: <a class="reference external" href="https://github.com/jeremiahschung">Jeremiah Chung</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h2>
<p>Semantic image segmentation is a computer vision task that uses semantic labels to mark specific regions of an input image. The PyTorch semantic image segmentation <a class="reference external" href="https://pytorch.org/hub/pytorch_vision_deeplabv3_resnet101">DeepLabV3 model</a> can be used to label image regions with <a class="reference external" href="http://host.robots.ox.ac.uk:8080/pascal/VOC/voc2007/segexamples/index.html">20 semantic classes</a> including, for example, bicycle, bus, car, dog, and person. Image segmentation models can be very useful in applications such as autonomous driving and scene understanding.</p>
<p>In this tutorial, we will provide a step-by-step guide on how to prepare and run the PyTorch DeepLabV3 model on iOS, taking you from the beginning of having a model you may want to use on iOS to the end of having a complete iOS app using the model. We will also cover practical and general tips on how to check if your next favorite pre-trained PyTorch models can run on iOS, and how to avoid pitfalls.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before going through this tutorial, you should check out <a class="reference external" href="https://pytorch.org/mobile/ios/">PyTorch Mobile for iOS</a> and give the PyTorch iOS <a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/HelloWorld">HelloWorld</a> example app a quick try. This tutorial will go beyond the image classification model, usually the first kind of model deployed on mobile. The complete code repo for this tutorial is available <a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/ImageSegmentation">here</a>.</p>
</div>
</div>
<div class="section" id="learning-objectives">
<h2>Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">Â¶</a></h2>
<p>In this tutorial, you will learn how to:</p>
<ol class="arabic simple">
<li>Convert the DeepLabV3 model for iOS deployment.</li>
<li>Get the output of the model for the example input image in Python and compare it to the output from the iOS app.</li>
<li>Build a new iOS app or reuse an iOS example app to load the converted model.</li>
<li>Prepare the input into the format that the model expects and process the model output.</li>
<li>Complete the UI, refactor, build and run the app to see image segmentation in action.</li>
</ol>
</div>
<div class="section" id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li>PyTorch 1.6 or 1.7</li>
<li>torchvision 0.7 or 0.8</li>
<li>Xcode 11 or 12</li>
</ul>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="convert-the-deeplabv3-model-for-ios-deployment">
<h3>1. Convert the DeepLabV3 model for iOS deployment<a class="headerlink" href="#convert-the-deeplabv3-model-for-ios-deployment" title="Permalink to this headline">Â¶</a></h3>
<p>The first step to deploying a model on iOS is to convert the model into the <a class="reference external" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">TorchScript</a> format.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all PyTorch models can be converted to TorchScript at this time because a model definition may use language features that are not in TorchScript, which is a subset of Python. See the <a class="reference external" href="../recipes/script_optimized.html">Script and Optimize Recipe</a> for more details.</p>
</div>
<p>Simply run the script below to generate the scripted model <cite>deeplabv3_scripted.pt</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># use deeplabv3_resnet50 instead of deeplabv3_resnet101 to reduce the model size</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;pytorch/vision:v0.8.0&#39;</span><span class="p">,</span> <span class="s1">&#39;deeplabv3_resnet50&#39;</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="n">scriptedm</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">scriptedm</span><span class="p">,</span> <span class="s2">&quot;deeplabv3_scripted.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The size of the generated <cite>deeplabv3_scripted.pt</cite> model file should be around 168MB. Ideally, a model should also be quantized for significant size reduction and faster inference before being deployed on an iOS app. To have a general understanding of quantization, see the <a class="reference external" href="../recipes/quantization.html">Quantization Recipe</a> and the resource links there. We will cover in detail how to correctly apply a quantization workflow called Post Training <a class="reference external" href="https://pytorch.org/tutorials/advanced/static_quantization_tutorial.html">Static Quantization</a> to the DeepLabV3 model in a future tutorial or recipe.</p>
</div>
<div class="section" id="get-example-input-and-output-of-the-model-in-python">
<h3>2. Get example input and output of the model in Python<a class="headerlink" href="#get-example-input-and-output-of-the-model-in-python" title="Permalink to this headline">Â¶</a></h3>
<p>Now that we have a scripted PyTorch model, letâ€™s test with some example inputs to make sure the model works correctly on iOS. First, letâ€™s write a Python script that uses the model to make inferences and examine inputs and outputs. For this example of the DeepLabV3 model, we can reuse the code in Step 1 and in the <a class="reference external" href="https://pytorch.org/hub/pytorch_vision_deeplabv3_resnet101">DeepLabV3 model hub site</a>. Add the following code snippet to the code above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="k">import</span> <span class="n">transforms</span>
<span class="n">input_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;deeplab.jpg&quot;</span><span class="p">)</span>
<span class="n">preprocess</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span> <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">]),</span>
<span class="p">])</span>

<span class="n">input_tensor</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<span class="n">input_batch</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_batch</span><span class="p">)[</span><span class="s1">&#39;out&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">input_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>Download <cite>deeplab.jpg</cite> from <a class="reference external" href="https://github.com/pytorch/ios-demo-app/blob/master/ImageSegmentation/ImageSegmentation/deeplab.jpg">here</a> and run the script above to see the shapes of the input and output of the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>
<span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">21</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>
</pre></div>
</div>
<p>So if you provide the same image input <cite>deeplab.jpg</cite> of size 400x400 to the model on iOS, the output of the model should have the size [21, 400, 400]. You should also print out at least the beginning parts of the actual data of the input and output, to be used in Step 4 below to compare with the actual input and output of the model when running in the iOS app.</p>
</div>
<div class="section" id="build-a-new-ios-app-or-reuse-an-example-app-and-load-the-model">
<h3>3. Build a new iOS app or reuse an example app and load the model<a class="headerlink" href="#build-a-new-ios-app-or-reuse-an-example-app-and-load-the-model" title="Permalink to this headline">Â¶</a></h3>
<p>First, follow Step 3 of the <a class="reference external" href="../recipes/model_preparation_ios.html#add-the-model-and-pytorch-library-on-ios">Model Preparation for iOS recipe</a> to use our model in an Xcode project with PyTorch Mobile enabled. Because both the DeepLabV3 model used in this tutorial and the MobileNet v2 model used in the PyTorch HelloWorld iOS example are computer vision models, you may choose to start with the <a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/HelloWorld">HelloWorld example repo</a> as a template to reuse the code that loads the model and processes the input and output.</p>
<p>Now letâ€™s add <cite>deeplabv3_scripted.pt</cite> and <cite>deeplab.jpg</cite> used in Step 2 to the Xcode project and modify <cite>ViewController.swift</cite> to resemble:</p>
<div class="highlight-swift notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">image</span> <span class="p">=</span> <span class="bp">UIImage</span><span class="p">(</span><span class="n">named</span><span class="p">:</span> <span class="s">&quot;deeplab.jpg&quot;</span><span class="p">)</span><span class="o">!</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">module</span><span class="p">:</span> <span class="n">TorchModule</span> <span class="p">=</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">filePath</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="s">&quot;deeplabv3_scripted&quot;</span><span class="p">,</span>
              <span class="n">ofType</span><span class="p">:</span> <span class="s">&quot;pt&quot;</span><span class="p">),</span>
            <span class="kd">let</span> <span class="nv">module</span> <span class="p">=</span> <span class="n">TorchModule</span><span class="p">(</span><span class="n">fileAtPath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">module</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="bp">fatalError</span><span class="p">(</span><span class="s">&quot;Can&#39;t load the model file!&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then set a breakpoint at the line <cite>return module</cite> and build and run the app. The app should stop at the breakpoint, meaning that the scripted model in Step 1 has been successfully loaded on iOS.</p>
</div>
<div class="section" id="process-the-model-input-and-output-for-model-inference">
<h3>4. Process the model input and output for model inference<a class="headerlink" href="#process-the-model-input-and-output-for-model-inference" title="Permalink to this headline">Â¶</a></h3>
<p>After the model loads in the previous step, letâ€™s verify that it works with expected inputs and can generate expected outputs. As the model input for the DeepLabV3 model is an image, the same as that of the MobileNet v2 in the HelloWorld example, we will reuse some of the code in the <a class="reference external" href="https://github.com/pytorch/ios-demo-app/blob/master/HelloWorld/HelloWorld/HelloWorld/TorchBridge/TorchModule.mm">TorchModule.mm</a> file from HelloWorld for input processing. Replace the <cite>predictImage</cite> method implementation in <cite>TorchModule.mm</cite> with the following code:</p>
<div class="highlight-objective-c notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="nf">predictImage:</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="nv">imageBuffer</span> <span class="p">{</span>
    <span class="c1">// 1. the example deeplab.jpg size is size 400x400 and there are 21 semantic classes</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">CLASSNUM</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>

    <span class="n">at</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">from_blob</span><span class="p">(</span><span class="n">imageBuffer</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">},</span> <span class="n">at</span><span class="o">::</span><span class="n">kFloat</span><span class="p">);</span>
    <span class="n">torch</span><span class="o">::</span><span class="n">autograd</span><span class="o">::</span><span class="n">AutoGradMode</span> <span class="n">guard</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">at</span><span class="o">::</span><span class="n">AutoNonVariableTypeMode</span> <span class="n">non_var_type_mode</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="c1">// 2. convert the input tensor to an NSMutableArray for debugging</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">floatInput</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">.</span><span class="n">data_ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">floatInput</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="bp">NSMutableArray</span><span class="o">*</span> <span class="n">inputs</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">inputs</span> <span class="nl">addObject</span><span class="p">:</span><span class="l">@(</span><span class="n">floatInput</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="l">)</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// 3. the output of the model is a dictionary of string and tensor, as</span>
    <span class="c1">// specified at https://pytorch.org/hub/pytorch_vision_deeplabv3_resnet101</span>
    <span class="k">auto</span> <span class="n">outputDict</span> <span class="o">=</span> <span class="n">_impl</span><span class="p">.</span><span class="n">forward</span><span class="p">({</span><span class="n">tensor</span><span class="p">}).</span><span class="n">toGenericDict</span><span class="p">();</span>

    <span class="c1">// 4. convert the output to another NSMutableArray for easy debugging</span>
    <span class="k">auto</span> <span class="n">outputTensor</span> <span class="o">=</span> <span class="n">outputDict</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;out&quot;</span><span class="p">).</span><span class="n">toTensor</span><span class="p">();</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">floatBuffer</span> <span class="o">=</span> <span class="n">outputTensor</span><span class="p">.</span><span class="n">data_ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">floatBuffer</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="bp">NSMutableArray</span><span class="o">*</span> <span class="n">results</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CLASSNUM</span> <span class="o">*</span> <span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">[</span><span class="n">results</span> <span class="nl">addObject</span><span class="p">:</span><span class="l">@(</span><span class="n">floatBuffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="l">)</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The model output is a dictionary for the DeepLabV3 model so we use <cite>toGenericDict</cite> to correctly extract the result. For other models, the model output may also be a single tensor or a tuple of tensors, among other things.</p>
</div>
<p>With the code changes shown above, you can set breakpoints after the two for loops that populate <cite>inputs</cite> and <cite>results</cite> and compare them with the model input and output data you saw in Step 2 to see if they match. For the same inputs to the models running on iOS and Python, you should get the same outputs.</p>
<p>All we have done so far is to confirm that the model of our interest can be scripted and run correctly in our iOS app as in Python. The steps we walked through so far for using a model in an iOS app consumes the bulk, if not most, of our app development time, similar to how data preprocessing is the heaviest lift for a typical machine learning project.</p>
</div>
<div class="section" id="complete-the-ui-refactor-build-and-run-the-app">
<h3>5. Complete the UI, refactor, build and run the app<a class="headerlink" href="#complete-the-ui-refactor-build-and-run-the-app" title="Permalink to this headline">Â¶</a></h3>
<p>Now we are ready to complete the app and the UI to actually see the processed result as a new image. The output processing code should be like this, added to the end of the code snippet in Step 4 in <cite>TorchModule.mm</cite> - remember to first remove the line <cite>return nil;</cite> temporarily put there to make the code build and run:</p>
<div class="highlight-objective-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// see the 20 semantic classes link in Introduction</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">DOG</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PERSON</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SHEEP</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>

<span class="bp">NSMutableData</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableData</span> <span class="nl">dataWithLength</span><span class="p">:</span>
    <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)[</span><span class="n">data</span> <span class="n">mutableBytes</span><span class="p">];</span>
<span class="c1">// go through each element in the output of size [WIDTH, HEIGHT] and</span>
<span class="c1">// set different color for different classnum</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">WIDTH</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">HEIGHT</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// maxi: the index of the 21 CLASSNUM with the max probability</span>
        <span class="kt">int</span> <span class="n">maxi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">maxnum</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100000.0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CLASSNUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">([</span><span class="n">results</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">WIDTH</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="n">floatValue</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maxnum</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">maxnum</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">WIDTH</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="n">floatValue</span><span class="p">];</span>
                <span class="n">maxi</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">maxj</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="n">maxk</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxj</span> <span class="o">*</span> <span class="n">width</span> <span class="o">+</span> <span class="n">maxk</span><span class="p">);</span>
        <span class="c1">// color coding for person (red), dog (green), sheep (blue)</span>
        <span class="c1">// black color for background and other classes</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">==</span> <span class="n">PERSON</span><span class="p">)</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">==</span> <span class="n">DOG</span><span class="p">)</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">==</span> <span class="n">SHEEP</span><span class="p">)</span> <span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">buffer</span><span class="p">;</span>
</pre></div>
</div>
<p>The implementation here is based on the understanding of the DeepLabV3 model which outputs a tensor of size [21, width, height] for an input image of width*height. Each element in the width*height output array is a value between 0 and 20 (for a total of 21 semantic labels described in Introduction) and the value is used to set a specific color. Color coding of the segmentation here is based on the class with the highest probability, and you can extend the color coding for all classes in your own dataset.</p>
<p>After the output processing, you will also need to call a helper function to convert the RGB <cite>buffer</cite> to an <cite>UIImage</cite> instance to be shown on <cite>UIImageView</cite>. You can refer to the example code <cite>convertRGBBufferToUIImage</cite> defined in <cite>UIImageHelper.mm</cite> in the code repo.</p>
<p>The UI for this app is also similar to that for HelloWorld, except that you do not need the <cite>UITextView</cite> to show the image classification result. You can also add two buttons <cite>Segment</cite> and <cite>Restart</cite> as shown in the code repo to run the model inference and to show back the original image after the segmentation result is shown.</p>
<p>The last step before we can run the app is to connect all the pieces together. Modify the <cite>ViewController.swift</cite> file to use the <cite>predictImage</cite>, which is refactored and changed to <cite>segmentImage</cite> in the repo, and helper functions you built as shown in the example code in the repo in <cite>ViewController.swift</cite>. Connect the buttons to the actions and you should be good to go.</p>
<p>Now when you run the app on an iOS simulator or an actual iOS device, you will see the following screens:</p>
<a class="reference internal image-reference" href="_static/img/deeplabv3_ios.png"><img alt="_static/img/deeplabv3_ios.png" src="_static/img/deeplabv3_ios.png" style="width: 300px;" /></a>
<a class="reference internal image-reference" href="_static/img/deeplabv3_ios2.png"><img alt="_static/img/deeplabv3_ios2.png" src="_static/img/deeplabv3_ios2.png" style="width: 300px;" /></a>
</div>
</div>
<div class="section" id="recap">
<h2>Recap<a class="headerlink" href="#recap" title="Permalink to this headline">Â¶</a></h2>
<p>In this tutorial, we described what it takes to convert a pre-trained PyTorch DeepLabV3 model for iOS and how to make sure the model can run successfully on iOS. Our focus was to help you understand the process of confirming that a model can indeed run on iOS. The complete code repo is available <a class="reference external" href="https://github.com/pytorch/ios-demo-app/tree/master/ImageSegmentation">here</a>.</p>
<p>More advanced topics such as quantization and using models via transfer learning or of your own on iOS will be covered soon in future demo apps and tutorials.</p>
</div>
<div class="section" id="learn-more">
<h2>Learn More<a class="headerlink" href="#learn-more" title="Permalink to this headline">Â¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://pytorch.org/mobile">PyTorch Mobile site</a></li>
<li><a class="reference external" href="https://pytorch.org/hub/pytorch_vision_deeplabv3_resnet101">DeepLabV3 model</a></li>
<li><a class="reference external" href="https://arxiv.org/pdf/1706.05587.pdf">DeepLabV3 paper</a></li>
</ol>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="iosObjectDetection.html" class="btn btn-neutral float-right" title="iOS Object Detection" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="iosD2Go.html" class="btn btn-neutral" title="iOS D2Go" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Facebook.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Image Segmentation DeepLabV3 on iOS</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#learning-objectives">Learning Objectives</a></li>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#steps">Steps</a><ul>
<li><a class="reference internal" href="#convert-the-deeplabv3-model-for-ios-deployment">1. Convert the DeepLabV3 model for iOS deployment</a></li>
<li><a class="reference internal" href="#get-example-input-and-output-of-the-model-in-python">2. Get example input and output of the model in Python</a></li>
<li><a class="reference internal" href="#build-a-new-ios-app-or-reuse-an-example-app-and-load-the-model">3. Build a new iOS app or reuse an example app and load the model</a></li>
<li><a class="reference internal" href="#process-the-model-input-and-output-for-model-inference">4. Process the model input and output for model inference</a></li>
<li><a class="reference internal" href="#complete-the-ui-refactor-build-and-run-the-app">5. Complete the UI, refactor, build and run the app</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recap">Recap</a></li>
<li><a class="reference internal" href="#learn-more">Learn More</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script type="text/javascript" src="../_static/jquery.js"></script>
         <script type="text/javascript" src="../_static/underscore.js"></script>
         <script type="text/javascript" src="../_static/doctools.js"></script>
         <script type="text/javascript" src="../_static/language_data.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #00ff00;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #E73422;
    }
  </style>
  


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>